!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.XL=e()}}(function(){return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return o(n?n:e)},u,u.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";if(String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),"function"!=typeof window.CustomEvent){var r=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n};r.prototype=window.Event.prototype,window.CustomEvent=r}},{}],2:[function(e,t,n){"use strict";var r=function(e,t){var n=this;this.baseUrl=t||"//login.xsolla.com/api/",this.projectId=e,this.makeApiCall=function(e,t,r){var o=new XMLHttpRequest;o.withCredentials=!0,o.open(e.method,n.baseUrl+e.endpoint,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?t(JSON.parse(o.responseText)):r(o.responseText?JSON.parse(o.responseText):{error:{message:"Networking error",code:o.status}}))},"POST"==e.method?(o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),o.send(e.postBody)):"GET"==e.method&&o.send(e.getArguments)}};r.prototype.getSocialsURLs=function(e,t,n){var r="";for(var o in n)""!=r&&(r+="&"),r+=o+"="+encodeURIComponent(n[o]);return this.makeApiCall({method:"GET",endpoint:"social/login_urls?"+r,getArguments:null},e,t)},r.prototype.loginPassAuth=function(e,t,n,r,o,i){var s={username:e,password:t,remember_me:n};return this.makeApiCall({method:"POST",endpoint:"proxy/login?projectId="+this.projectId+"&redirect_url="+encodeURIComponent(r),postBody:JSON.stringify(s)},o,i)},r.prototype.smsAuth=function(e,t,n){return this.makeApiCall({method:"GET",endpoint:"sms",getArguments:"phoneNumber="+e},t,n)},t.exports=r},{}],main:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("./xlapi"),l=r(a);e("./supports");var c={errorHandler:function(e){},loginPassValidator:function(e,t){return!0},isMarkupSocialsHandlersEnabled:!1,apiUrl:"//login.xsolla.com/api/",maxXLClickDepth:20,onlyWidgets:!1,preloader:"<div></div>"},u=2,d=function(){function e(){o(this,e),this.socialUrls={},this.eventTypes={LOAD:"load",CLOSE:"close"},this.dispatcher=document.createElement("div")}return s(e,[{key:"init",value:function(e){var t=this;this.config=i({},c,e),this.api=new l["default"](e.projectId,this.config.apiUrl),Object.keys(this.eventTypes).map(function(e){t.on(t.eventTypes[e])}),this.config.onlyWidgets||!function(){var n=function(e){if(e.attributes["data-xl-auth"])return e;for(var t=0;(e=e.parentElement)&&!e.attributes["data-xl-auth"]&&++t<i;);return e},r={};r.projectId=e.projectId,t.config.redirectUrl&&(r.redirect_url=t.config.redirectUrl);var o=function(){t.api.getSocialsURLs(function(e){t.socialUrls={};for(var n in e)e.hasOwnProperty(n)&&(t.socialUrls["sn-"+n]=e[n])},function(e){console.error(e)},r)};o(),setInterval(o,354e4);var i=t.config.maxXLClickDepth;t.config.isMarkupSocialsHandlersEnabled&&document.addEventListener("click",function(e){var r=n(e.target);if(r){var o=r.attributes["data-xl-auth"];if(o){var i=o.nodeValue;i&&t.login({authType:i})}}})}()}},{key:"login",value:function(e,t,n){var r=this;if(e&&this.socialUrls&&e.authType)if(e.authType.startsWith("sn-")){var o=this.socialUrls[e.authType];void 0!=o?window.location.href=this.socialUrls[e.authType]:console.error("Auth type: "+e.authType+" doesn't exist")}else"login-pass"==e.authType?this.api.loginPassAuth(e.login,e.pass,e.rememberMe,this.config.redirectUrl,function(e){if(e.login_url){var o=function(){window.location.href=e.login_url};n?n({status:"success",finish:o,redirectUrl:e.login_url}):o()}else t(r.createErrorObject("Login or pass not valid",u))},function(e){t(e)}):"sms"==e.authType?"phone"==smsAuthStep?this.api.smsAuth(e.phoneNumber,null,null):"code"==smsAuthStep:console.error("Unknown auth type")}},{key:"createErrorObject",value:function(e,t){return{error:{message:e,code:t||-1}}}},{key:"getProjectId",value:function(){return this.config.projectId}},{key:"getRedirectURL",value:function(){return this.config.redirectUrl}},{key:"AuthWidget",value:function(e,t){var n=this;this.api?e?!function(){void 0==t&&(t={});var r=(t.width||400)+"px",o=(t.height||550)+"px",i=t.widgetBaseUrl||"https://xl-widget.xsolla.com/",s=i+"?projectId="+n.getProjectId();n.config.locale&&(s=s+"&locale="+n.config.locale),n.config.fields&&(s=s+"&fields="+n.config.fields);var a=n.getRedirectURL();a&&(s=s+"&redirectUrl="+encodeURIComponent(a));var l=document.createElement("iframe");l.onload=function(){f.removeChild(p),l.style.width="100%",l.style.height="100%";var e=new CustomEvent("load");n.dispatcher.dispatchEvent(e)},l.style.width=0,l.style.height=0,l.frameBorder="0",l.src=s,l.id="XsollaLoginWidgetIframe";var c=window.addEventListener?"addEventListener":"attachEvent",u=window[c],d="attachEvent"==c?"onmessage":"message";u(d,function(e){var t=new CustomEvent(n.eventTypes[e.data]);n.dispatcher.dispatchEvent(t)},!1);var p=document.createElement("div");p.innerHTML=n.config.preloader;var f=document.getElementById(e);f?(f.style.width=r,f.style.height=o,f.appendChild(p),f.appendChild(l)):console.error('Element "'+e+'" not found!')}():console.error("No div name!"):console.error("Please run XL.init() first")}},{key:"onCloseEvent",value:function(){var e=document.getElementById("XsollaLoginWidgetIframe");e.parentNode.removeChild(e)}},{key:"on",value:function(e,t){t=t||null,e===this.eventTypes.CLOSE&&(t?this.dispatcher.removeEventListener(e,this.onCloseEvent):t=this.onCloseEvent),this.dispatcher.addEventListener(e,t)}}]),e}(),p=new d;t.exports=p},{"./supports":1,"./xlapi":2}]},{},["main"])("main")});
//# sourceMappingURL=xl.min.js.map